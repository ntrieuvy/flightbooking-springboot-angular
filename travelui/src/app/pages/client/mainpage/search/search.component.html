<div class="search-container__top">
    <app-flight-search (searchSubmitted)="handleSearch($event)"></app-flight-search>
</div>

<div class="search-container">
    <div class="search-container__main-content">
        <!-- Filters Sidebar -->
        <aside class="filters-sidebar">
            <div class="filter-section">
                <h3 class="section-title">Sort by</h3>
                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" name="sort" value="price" [(ngModel)]="sortBy" (change)="applyFilters()">
                        <span class="radio-checkmark"></span>
                        Price (Low to High)
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="sort" value="duration" [(ngModel)]="sortBy" (change)="applyFilters()">
                        <span class="radio-checkmark"></span>
                        Duration (Short to Long)
                    </label>
                </div>
            </div>

            <div class="filter-section">
                <h3 class="section-title">Airlines</h3>
                <div class="checkbox-group">
                    <label class="checkbox-item" *ngFor="let airline of airlines">
                        <input type="checkbox" [checked]="selectedAirlines.includes(airline)"
                            (change)="toggleAirlineSelection(airline, $event)">
                        <span class="checkbox-mark"></span>
                        {{ airline }}
                    </label>
                </div>
            </div>

            <div class="filter-section">
                <h3 class="section-title">Price Range</h3>
                <div class="price-range">
                    <div class="range-inputs">
                        <input type="number" placeholder="Min" [(ngModel)]="minPrice" (change)="applyFilters()">
                        <input type="number" placeholder="Max" [(ngModel)]="maxPrice" (change)="applyFilters()">
                    </div>
                    <div class="price-display">
                        {{ minPrice || 0 | currency:'VND' }} - {{ maxPrice | currency:'VND' }}
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="results-main">
            <!-- Loading/Error States -->
            <div *ngIf="loading" class="loading-state">
                <div class="spinner"></div>
                <p>Searching for flights...</p>
            </div>

            <div *ngIf="error" class="error-state">
                ‚ö†Ô∏è {{ error }}
            </div>

            <!-- Results -->
            <div *ngIf="flightResults?.data?.ListGroup?.length > 0" class="flight-results">
                <!-- Tabs Navigation -->
                <nav class="results-tabs">
                    <button *ngFor="let group of filteredGroups; let i = index" [class.active]="activeTabIndex === i"
                        (click)="activeTabIndex = i">
                        {{ group.StartPoint }} ‚Üí {{ group.EndPoint }}
                    </button>
                </nav>

                <!-- Flight List -->
                <div class="flight-list">
                    <div *ngFor="let option of filteredGroups[activeTabIndex]?.ListAirOption" class="flight-item">
                        <!-- Airline Info -->
                        <div class="airline-section">

                            <img [src]="'https://plugin.datacom.vn/Resources/Images/Airline/' + option.Airline + '.gif'"
                                class="airline-logo">
                            <div class="airline-details">
                                <h4>{{ getAirlineName(option.Airline) }}</h4>
                                <div class="remaining-seats">{{ option.selectedFare.Availability }}</div>
                            </div>
                        </div>

                        <!-- Flight Details -->
                        <div class="flight-details">
                            <div class="time-block">
                                <div class="departure">
                                    <strong>{{ formatTime(option.ListFlightOption[0].ListFlight[0].StartDate)
                                        }}</strong>
                                    <span>{{ option.ListFlightOption[0].ListFlight[0].StartPoint }}</span>
                                </div>
                                <div class="duration">
                                    <span class="icon">‚è±</span>
                                    {{ formatDuration(option.ListFlightOption[0].ListFlight[0].Duration) }}
                                </div>
                                <div class="arrival">
                                    <strong>{{ formatTime(option.ListFlightOption[0].ListFlight[0].EndDate) }}</strong>
                                    <span>{{ option.ListFlightOption[0].ListFlight[0].EndPoint }}</span>
                                </div>
                            </div>
                            <div class="flight-meta">
                                <span>‚úàÔ∏è Flight {{ option.ListFlightOption[0].ListFlight[0].FlightNumber }}</span>
                                <span>üõÑ {{ option.ListFareOption[0].ListFarePax[0].ListFareInfo[0].FreeBaggage
                                    }}</span>
                            </div>
                        </div>

                        <!-- Fare Selection & Booking -->
                        <div class="booking-section">
                            <select class="fare-select" (change)="onFareSelect($event, option)">
                                <option *ngFor="let fare of option.ListFareOption" [value]="fare.CabinName">
                                    {{ fare.CabinName }}
                                </option>
                            </select>

                            <div class="price-box">
                                <div class="price">
                                    {{ option.selectedFare.TotalFare |
                                    currency:option.selectedFare.Currency:'symbol':'1.0-0' }}
                                    <div class="badge">
                                        <span [ngClass]="getRemarkClass(option.Remark)">
                                            {{ option.Remark }}
                                        </span>
                                        <span class="option-details" (click)="openFlightDetailModal(option)">Details</span>
                                    </div>
                                </div>
                                <button class="book-button" (click)="bookFlight(option)">
                                    Book Now ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <app-flight-detail-modal [showDetailModal]="showDetailModal" [selectedOption]="selectedFlight" (closeModal)="closeDetailModal()">
                </app-flight-detail-modal>



                <!-- <div class="modal" *ngIf="showDetailModal">
                    <div class="modal-content">
                        <span class="close" (click)="closeDetailModal()">&times;</span>
                        <h2>Flight Details</h2>

                        <div class="flight-summary">
                            <div class="airline-info">
                                <div class="airline-logo">{{selectedOption?.Airline}}</div>
                                <div class="flight-number">Flight:
                                    {{selectedOption?.ListFlightOption[0]?.ListFlight[0]?.FlightNumber}}</div>
                            </div>

                            <div class="route-info">
                                <div class="departure">
                                    <div class="time">
                                        {{formatTime(selectedOption?.ListFlightOption[0]?.ListFlight[0]?.StartDate)}}
                                    </div>
                                    <div class="airport">
                                        {{selectedOption?.ListFlightOption[0]?.ListFlight[0]?.StartPoint}}</div>
                                    <div class="terminal">Terminal:
                                        {{selectedOption?.ListFlightOption[0]?.ListFlight[0]?.ListSegment[0]?.StartTerminal}}
                                    </div>
                                </div>

                                <div class="duration">
                                    <div class="duration-text">
                                        {{formatDuration(selectedOption?.ListFlightOption[0]?.ListFlight[0]?.Duration)}}
                                    </div>
                                    <div class="divider-line"></div>
                                    <div class="flight-type">{{selectedOption?.Remark}}</div>
                                </div>

                                <div class="arrival">
                                    <div class="time">
                                        {{formatTime(selectedOption?.ListFlightOption[0]?.ListFlight[0]?.EndDate)}}
                                    </div>
                                    <div class="airport">
                                        {{selectedOption?.ListFlightOption[0]?.ListFlight[0]?.EndPoint}}</div>
                                    <div class="terminal">Terminal:
                                        {{selectedOption?.ListFlightOption[0]?.ListFlight[0]?.ListSegment[0]?.EndTerminal}}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="details-section">
                            <h3>Flight Information</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="label">Aircraft:</span>
                                    <span
                                        class="value">{{selectedOption?.ListFlightOption[0]?.ListFlight[0]?.ListSegment[0]?.Equipment}}</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Cabin Class:</span>
                                    <span class="value">{{selectedOption?.selectedFare?.CabinName}}</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Fare Class:</span>
                                    <span class="value">{{selectedOption?.selectedFare?.FareClass}}</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Baggage Allowance:</span>
                                    <span
                                        class="value">{{selectedOption?.selectedFare?.ListFarePax[0]?.ListFareInfo[0]?.HandBaggage}}
                                        hand +
                                        {{selectedOption?.selectedFare?.ListFarePax[0]?.ListFareInfo[0]?.FreeBaggage}}
                                        checked</span>
                                </div>
                            </div>
                        </div>

                        <div class="details-section">
                            <h3>Fare Breakdown</h3>
                            <div class="fare-breakdown">
                                <div class="fare-row">
                                    <span class="fare-label">Base Fare:</span>
                                    <span class="fare-value">{{selectedOption?.selectedFare?.BaseFare |
                                        currency:selectedOption?.selectedFare?.Currency:'symbol':'1.0-0'}}</span>
                                </div>
                                <div class="fare-row"
                                    *ngFor="let item of selectedOption?.selectedFare?.ListFarePax[0]?.ListFareItem">
                                    <span class="fare-label">{{item.Name}}:</span>
                                    <span class="fare-value">{{item.Amount |
                                        currency:selectedOption?.selectedFare?.Currency:'symbol':'1.0-0'}}</span>
                                </div>
                                <div class="fare-row total">
                                    <span class="fare-label">Total Fare:</span>
                                    <span class="fare-value">{{selectedOption?.selectedFare?.TotalFare |
                                        currency:selectedOption?.selectedFare?.Currency:'symbol':'1.0-0'}}</span>
                                </div>
                            </div>
                        </div>

                        <div class="details-section">
                            <h3>Additional Information</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="label">Refundable:</span>
                                    <span class="value">{{selectedOption?.selectedFare?.Refundable ? 'Yes' :
                                        'No'}}</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Availability:</span>
                                    <span class="value">{{selectedOption?.selectedFare?.Availability}} seats</span>
                                </div>
                                <div class="info-item">
                                    <span class="label">Expiry Date:</span>
                                    <span class="value">{{formatDate(selectedOption?.selectedFare?.ExpiryDate)}}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> -->
            </div>

            <!-- No Results -->
            <div *ngIf="!loading && !error && flightResults?.data?.ListGroup?.length === 0" class="no-results">
                ‚úàÔ∏è No flights found matching your criteria
            </div>
        </main>
    </div>
</div>